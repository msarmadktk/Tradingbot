//@version=5
strategy("Assignment Visual Scalper (Supertrend)", overlay=true, default_qty_type=strategy.percent_of_equity, default_qty_value=10)

// --- 1. SETTINGS ---
atrPeriod = input.int(10, "ATR Length")
factor = input.float(2.0, "Factor", step=0.1)

// --- 2. CALCULATIONS ---
[supertrendLine, direction] = ta.supertrend(factor, atrPeriod)

// --- 3. TRADING LOGIC ---
buySignal = ta.change(direction) < 0
sellSignal = ta.change(direction) > 0

// --- 4. JSON PAYLOADS ---
alertMsgBuy = '{"action": "buy", "symbol": "' + syminfo.ticker + '", "price": ' + str.tostring(close) + '}'
alertMsgSell = '{"action": "sell", "symbol": "' + syminfo.ticker + '", "price": ' + str.tostring(close) + '}'

// --- 5. EXECUTION ---
if (buySignal)
    strategy.entry("Trend Buy", strategy.long, alert_message=alertMsgBuy)

if (sellSignal)
    strategy.entry("Trend Sell", strategy.short, alert_message=alertMsgSell)

// --- 6. VISUALS ---
plot(supertrendLine, "SuperTrend", color = direction == -1 ? color.green : color.red, linewidth=2)
bgcolor(direction == -1 ? color.new(color.green, 90) : color.new(color.red, 90))
plotshape(buySignal, style=shape.labelup, location=location.belowbar, color=color.green, text="BUY", textcolor=color.white, size=size.small)
plotshape(sellSignal, style=shape.labeldown, location=location.abovebar, color=color.red, text="SELL", textcolor=color.white, size=size.small)